#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const stream = require('stream');
const child_process = require('child_process');

(async () => {
    const fd = fs.openSync(path.join(__dirname, '../cypress/cypress.log'), 'w+', 0644);
    const ws = stream.Writable({
        write: (data, encoding, cb) => fs.write(fd, data, undefined, encoding, cb),
    });

    child = child_process.spawn('node', ['./src/cypress-runner.js']);

    child.stdout.pipe(process.stdout);
    child.stderr.pipe(process.stderr);
    child.stdout.pipe(ws);
    child.stderr.pipe(ws);

    child.on('exit', () => ws.end(() => fs.closeSync(fd)));
})();
